const fs=require("fs"),csv=require("csv-parse"),Promise=require("bluebird"),pdf=Promise.promisifyAll(require("html-pdf")),parseador=csv({delimiter:",",cast:!0,relax_column_count:!0,comment:"#"});var productos=[],fila;const alertError=text=>{console.log("[31m",text,"[0m")},alertSuccess=text=>{console.log("[32m",text,"[0m")};parseador.on("readable",(function(){for(;fila=parseador.read();)productos.push(fila)})),parseador.on("error",(function(err){alertError("Error ->",err.message)}));var myArgs=process.argv.slice(2);void 0===myArgs[0]?alertError("No existe el csv: ",myArgs[0]):fs.existsSync(`csv/${myArgs[0]}.csv`)?fs.createReadStream(`csv/${myArgs[0]}.csv`).pipe(parseador).on("end",(function(){alertSuccess("Se ha terminado de leer el archivo"),createPDF(),parseador.end()})):alertError("El archivo NO EXISTE!"),createPDF=()=>{const formateador=new Intl.NumberFormat("en",{style:"currency",currency:"EUR"});productos.shift(),productos.forEach((function(producto){let contenidoHtml=fs.readFileSync("factura.html","utf8");contenidoHtml=contenidoHtml.replace("{{name}}",producto[6]),contenidoHtml=contenidoHtml.replace("{{dir}}",producto[9]),contenidoHtml=contenidoHtml.replace("{{ciudad}}",producto[10]),contenidoHtml=contenidoHtml.replace("{{correo}}",producto[12]),contenidoHtml=contenidoHtml.replace("{{numerofactura}}",producto[1]),contenidoHtml=contenidoHtml.replace("{{fecha}}",producto[4]),contenidoHtml=contenidoHtml.replace("{{numeropedido}}",producto[2]),contenidoHtml=contenidoHtml.replace("{{fechapedido}}",producto[4]),void 0===producto[14]&&(producto[14]=" -- "),contenidoHtml=contenidoHtml.replace("{{pago}}",producto[14]),contenidoHtml=contenidoHtml.replace("{{id}}",producto[0]),contenidoHtml=contenidoHtml.replace("{{precio}}",producto[15]),contenidoHtml=contenidoHtml.replace("{{sub}}",producto[15]),contenidoHtml=contenidoHtml.replace("{{impuestos}}",producto[18]),contenidoHtml=contenidoHtml.replace("{{total}}",producto[17]),pdf.createAsync(contenidoHtml,{format:"A4",filename:`facturas/${producto[1]}.pdf`}).then(pdf=>console.log(pdf)),producto=[]}))};